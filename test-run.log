
> vivatour-app@0.1.0 test
> jest --no-coverage

PASS src/__tests__/config/supplier-config.test.ts
  SUPPLIER_TYPES configuration
    âˆš should have 9 supplier types (18 ms)
    âˆš should have 3-character prefixes for all types (39 ms)
    âˆš should include all expected types (2 ms)
    âˆš should have correct prefix mappings (4 ms)
  SUPPLIER_LOCATIONS configuration
    âˆš should have 18 locations (1 ms)
    âˆš should have 2-3 character prefixes for all locations (8 ms)
    âˆš should include key Vietnam locations (1 ms)
    âˆš should include international locations (2 ms)
  PAYMENT_MODELS configuration
    âˆš should have 3 payment models (1 ms)
    âˆš should include all expected models (3 ms)
    âˆš should have labels and descriptions (2 ms)
  removeDiacritics
    âˆš should remove Vietnamese diacritics from A variants (2 ms)
    âˆš should remove Vietnamese diacritics from E variants (1 ms)
    âˆš should remove Vietnamese diacritics from I variants (1 ms)
    âˆš should remove Vietnamese diacritics from O variants (2 ms)
    âˆš should remove Vietnamese diacritics from U variants (1 ms)
    âˆš should remove Vietnamese diacritics from Y variants (1 ms)
    âˆš should convert Ä to D (1 ms)
    âˆš should preserve non-diacritic characters (1 ms)
    âˆš should handle mixed strings (1 ms)
    âˆš should handle empty string (1 ms)
  getNamePrefix
    âˆš should extract first 3 characters from simple name (1 ms)
    âˆš should use first word only (1 ms)
    âˆš should handle Vietnamese names with diacritics (2 ms)
    âˆš should pad short names with X (1 ms)
    âˆš should return XXX for empty name (1 ms)
    âˆš should return XXX for null/undefined (1 ms)
    âˆš should trim whitespace (1 ms)
    âˆš should convert to uppercase (1 ms)
  generateSupplierCode
    âˆš should generate correct code format: TYPE-LOCATION-NAME-SEQUENCE (1 ms)
    âˆš should use XX for missing location
    âˆš should use XX for undefined location
    âˆš should pad sequence to 4 digits (2 ms)
    âˆš should default sequence to 1 (1 ms)
    âˆš should handle Vietnamese names correctly
    âˆš should handle single character name
    âˆš should handle empty name (1 ms)
    âˆš should handle name with only spaces (1 ms)
    âˆš should handle multi-word names (use first word only) (1 ms)
    for each supplier type
      âˆš should use HOT for HOTEL (1 ms)
      âˆš should use RES for RESTAURANT
      âˆš should use TRA for TRANSPORT
      âˆš should use GUI for GUIDE (1 ms)
      âˆš should use VIS for VISA (1 ms)
      âˆš should use VMB for VMB
      âˆš should use CRU for CRUISE (1 ms)
      âˆš should use ACT for ACTIVITY (1 ms)
      âˆš should use OTH for OTHER (1 ms)
    for each location
      âˆš should use HN for HA_NOI (1 ms)
      âˆš should use DN for DA_NANG (1 ms)
      âˆš should use HCM for HO_CHI_MINH
      âˆš should use HL for HA_LONG (1 ms)
      âˆš should use PQ for PHU_QUOC (1 ms)
      âˆš should use TL for THAI_LAN
      âˆš should use CB for CAMBODIA

PASS src/__tests__/lib/supplier-balance.test.ts
  calculateSupplierBalance
    âˆš should calculate balance correctly with all transaction types (17 ms)
    âˆš should handle zero transactions (new supplier) (25 ms)
    âˆš should handle deposits only (12 ms)
    âˆš should calculate negative balance when costs exceed deposits (33 ms)
    âˆš should handle large numeric values (20 ms)
    âˆš should call Prisma with correct supplier ID (11 ms)
  getSupplierBalanceSummary
    âˆš should return balance summary for all active suppliers (12 ms)
    âˆš should filter by supplier type when provided (16 ms)
    âˆš should return empty results for no active suppliers (14 ms)
    âˆš should count positive and negative balances correctly (14 ms)

FAIL src/__tests__/config/operator-config.test.ts
  SERVICE_TYPES configuration
    âˆš should have 9 service types (29 ms)
    âˆš should include all expected types (36 ms)
    âˆš should have labels and icons for all types (12 ms)
    âˆš should have correct Vietnamese labels (3 ms)
    âˆš should have valid Lucide icon names (1 ms)
  PAYMENT_STATUSES configuration
    âˆš should have 3 payment statuses
    âˆš should include all expected statuses (1 ms)
    âˆš should have labels and colors for all statuses (1 ms)
    âˆš should have correct Vietnamese labels (1 ms)
    âˆš should have appropriate colors (1 ms)
  HISTORY_ACTIONS configuration
    Ã— should have 6 history action types (3 ms)
    âˆš should include all expected action types (3 ms)
    âˆš should have labels and colors for all actions (4 ms)
    âˆš should have correct Vietnamese labels (1 ms)
    âˆš should have appropriate colors (2 ms)
  DEFAULT_VAT_RATE constant
    âˆš should be 10 (percent) (1 ms)
    âˆš should be a positive number (1 ms)
    âˆš should be less than 100 (reasonable VAT rate) (1 ms)
  Service types alignment with Supplier types
    âˆš should have matching service types with supplier types (3 ms)

  â— HISTORY_ACTIONS configuration â€º should have 6 history action types

    expect(received).toHaveLength(expected)

    Expected length: 6
    Received length: 12
    Received array:  ["CREATE", "UPDATE", "DELETE", "LOCK", "UNLOCK", "LOCK_KT", "UNLOCK_KT", "LOCK_ADMIN", "UNLOCK_ADMIN", "LOCK_FINAL", â€¦]

    [0m [90m 93 |[39m describe([32m'HISTORY_ACTIONS configuration'[39m[33m,[39m () [33m=>[39m {
     [90m 94 |[39m   it([32m'should have 6 history action types'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 95 |[39m     expect([33mObject[39m[33m.[39mkeys([33mHISTORY_ACTIONS[39m))[33m.[39mtoHaveLength([35m6[39m)[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 96 |[39m   })[33m;[39m
     [90m 97 |[39m
     [90m 98 |[39m   it([32m'should include all expected action types'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toHaveLength (src/__tests__/config/operator-config.test.ts:95:42)

  console.error
    Error generating cost report: Error: Database error
        at Object.<anonymous> (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\src\__tests__\api\operator-reports.test.ts:149:52)
        at Promise.finally.completed (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 145 |[39m     })[33m;[39m
     [90m 146 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 147 |[39m     console[33m.[39merror([32m'Error generating cost report:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 148 |[39m     [36mconst[39m message [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
     [90m 149 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson(
     [90m 150 |[39m       { success[33m:[39m [36mfalse[39m[33m,[39m error[33m:[39m [32m`Lá»—i táº¡o bÃ¡o cÃ¡o: ${message}`[39m }[33m,[39m[0m

      at error (src/app/api/reports/operator-costs/route.ts:147:13)
      at Object.<anonymous> (src/__tests__/api/operator-reports.test.ts:152:22)

  console.error
    Error generating payment report: Error: Database error
        at Object.<anonymous> (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\src\__tests__\api\operator-reports.test.ts:232:53)
        at Promise.finally.completed (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 104 |[39m     })[33m;[39m
     [90m 105 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 106 |[39m     console[33m.[39merror([32m'Error generating payment report:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 107 |[39m     [36mconst[39m message [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
     [90m 108 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson(
     [90m 109 |[39m       { success[33m:[39m [36mfalse[39m[33m,[39m error[33m:[39m [32m`Lá»—i táº¡o bÃ¡o cÃ¡o: ${message}`[39m }[33m,[39m[0m

      at error (src/app/api/reports/operator-payments/route.ts:106:13)
      at Object.<anonymous> (src/__tests__/api/operator-reports.test.ts:235:22)

  console.error
    Error fetching suppliers: Error: Database connection failed
        at Object.<anonymous> (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\src\__tests__\api\suppliers.test.ts:203:52)
        at Promise.finally.completed (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 55 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson({ success[33m:[39m [36mtrue[39m[33m,[39m data[33m:[39m result })[33m;[39m
     [90m 56 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 57 |[39m     console[33m.[39merror([32m'Error fetching suppliers:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 58 |[39m     [36mconst[39m message [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
     [90m 59 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson(
     [90m 60 |[39m       { success[33m:[39m [36mfalse[39m[33m,[39m error[33m:[39m [32m`Failed to fetch suppliers: ${message}`[39m }[33m,[39m[0m

      at error (src/app/api/suppliers/route.ts:57:13)
      at Object.<anonymous> (src/__tests__/api/suppliers.test.ts:206:22)

PASS src/__tests__/api/operator-reports.test.ts
  GET /api/reports/operator-costs
    âˆš should return cost report grouped by service type, supplier, and month (88 ms)
    âˆš should filter by date range (14 ms)
    âˆš should filter by service type (8 ms)
    âˆš should handle empty data gracefully (11 ms)
    âˆš should handle database errors (168 ms)
    âˆš should reject invalid date format (7 ms)
    âˆš should reject invalid service type (7 ms)
  GET /api/reports/operator-payments
    âˆš should return payment status summary (10 ms)
    âˆš should handle null totals gracefully (9 ms)
    âˆš should handle database errors (30 ms)
    âˆš should reject invalid month format (22 ms)

  console.error
    Error fetching pending payments: Error: Database error
        at Object.<anonymous> (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\src\__tests__\api\operator-approvals.test.ts:183:52)
        at Promise.finally.completed (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 82 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson({ success[33m:[39m [36mtrue[39m[33m,[39m data[33m,[39m summary })[33m;[39m
     [90m 83 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 84 |[39m     console[33m.[39merror([32m'Error fetching pending payments:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 85 |[39m     [36mconst[39m message [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
     [90m 86 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson(
     [90m 87 |[39m       { success[33m:[39m [36mfalse[39m[33m,[39m error[33m:[39m [32m`Lá»—i táº£i danh sÃ¡ch: ${message}`[39m }[33m,[39m[0m

      at error (src/app/api/operators/pending-payments/route.ts:84:13)
      at Object.<anonymous> (src/__tests__/api/operator-approvals.test.ts:186:22)

PASS src/__tests__/lib/request-utils.test.ts
  generateRQID
    âˆš should generate RQID with correct format RQ-YYMMDD-XXXX (23 ms)
    âˆš should pad sequence number with zeros (26 ms)
    âˆš should pad sequence to 4 digits for count 999 (6 ms)
    âˆš should query requests created today (7 ms)
  generateBookingCode - Phase 1 Schema Changes
    with explicit sellerCode
      âˆš should use sellerCode when available (6 ms)
      âˆš should accept single char sellerCode (12 ms)
      âˆš should handle multi-char sellerCode (edge case) (11 ms)
    fallback to sellerName first letter
      âˆš should use first letter of name when sellerCode is null (9 ms)
      âˆš should uppercase first letter of name (9 ms)
      âˆš should handle single character name (11 ms)
    ultimate fallback to X
      âˆš should use X when no sellerCode and no name (13 ms)
      âˆš should use X when config user not found (10 ms)
      âˆš should use X when user object is missing (19 ms)
    sequence numbering
      âˆš should increment sequence for same date and code (57 ms)
      âˆš should start at 0001 when no existing codes (8 ms)
      âˆš should pad sequence with zeros (7 ms)
      âˆš should handle max 4-digit sequence (9999) (5 ms)
    date formatting
      âˆš should format date as YYYYMMDD (6 ms)
      âˆš should pad month and day with zeros (13 ms)
      âˆš should handle December dates (10 ms)
    existing booking codes preservation
      âˆš should not modify existing booking codes (9 ms)
      âˆš should query correctly with startsWith filter (11 ms)
  calculateEndDate
    âˆš should calculate end date as startDate + tourDays - 1 (14 ms)
    âˆš should handle single day tour (11 ms)
    âˆš should handle two day tour (22 ms)
    âˆš should handle long tour (cross month) (27 ms)
    âˆš should not mutate original date (18 ms)
  calculateNextFollowUp
    âˆš should calculate next follow-up date based on config (12 ms)
    âˆš should return null when config is not found (22 ms)
    âˆš should return null when config is inactive (30 ms)
    âˆš should handle 0 days to wait (22 ms)
    âˆš should handle large days to wait (15 ms)
  getSellerCode
    âˆš should return seller code when available (14 ms)
    âˆš should return null when seller code is null (17 ms)
    âˆš should return null when config not found (48 ms)
    âˆš should call findUnique with correct userId (13 ms)
  canUserViewAll
    âˆš should return true when canViewAll is true (20 ms)
    âˆš should return false when canViewAll is false (24 ms)
    âˆš should return false when config not found (11 ms)
  getFollowUpDateBoundaries
    âˆš should return today start and end dates (12 ms)
    âˆš todayStart should be at 00:00:00 (30 ms)
    âˆš todayEnd should be at 23:59:59.999 (15 ms)
    âˆš threeDaysLater should be 3 days after todayStart (14 ms)
    âˆš should have same date for todayStart and todayEnd (13 ms)

PASS src/__tests__/api/operator-approvals.test.ts
  GET /api/operators/pending-payments
    âˆš should return pending payments with success (40 ms)
    âˆš should filter by overdue (13 ms)
    âˆš should filter by today (27 ms)
    âˆš should filter by week (12 ms)
    âˆš should filter by serviceType (10 ms)
    âˆš should calculate daysOverdue correctly (7 ms)
    âˆš should return correct summary (7 ms)
    âˆš should return 500 on database error (264 ms)
  POST /api/operators/approve (batch)
    âˆš should batch approve operators successfully (12 ms)
    âˆš should return 400 when no operatorIds provided (10 ms)
    âˆš should return 400 when paymentDate is missing (10 ms)
    âˆš should return 404 when some operators not found (9 ms)
    âˆš should return 403 when trying to approve locked operators (9 ms)
  POST /api/operators/[id]/approve (single)
    âˆš should approve single operator successfully (13 ms)
    âˆš should return 404 when operator not found (19 ms)
    âˆš should return 403 when operator is locked (34 ms)
    âˆš should return 400 when already paid (16 ms)
    âˆš should use current date when paymentDate not provided (15 ms)

  console.error
    Error creating supplier: Error: Database write failed
        at Object.<anonymous> (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\src\__tests__\api\suppliers.test.ts:531:50)
        at Promise.finally.completed (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 148 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson({ success[33m:[39m [36mtrue[39m[33m,[39m data[33m:[39m supplier }[33m,[39m { status[33m:[39m [35m201[39m })[33m;[39m
     [90m 149 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 150 |[39m     console[33m.[39merror([32m'Error creating supplier:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 151 |[39m     [36mconst[39m message [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
     [90m 152 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson(
     [90m 153 |[39m       { success[33m:[39m [36mfalse[39m[33m,[39m error[33m:[39m [32m`Lá»—i táº¡o NCC: ${message}`[39m }[33m,[39m[0m

      at error (src/app/api/suppliers/route.ts:150:13)
      at Object.<anonymous> (src/__tests__/api/suppliers.test.ts:541:22)

PASS src/__tests__/api/suppliers.test.ts
  GET /api/suppliers
    âˆš should return all suppliers with success response (27 ms)
    âˆš should filter by search term (code or name) (10 ms)
    âˆš should filter by type (9 ms)
    âˆš should filter by location (23 ms)
    âˆš should filter by paymentModel (11 ms)
    âˆš should filter by isActive=true (7 ms)
    âˆš should filter by isActive=false (6 ms)
    âˆš should handle multiple filters combined (8 ms)
    âˆš should include balance when includeBalance=true (8 ms)
    âˆš should return 500 on database error (216 ms)
    âˆš should return empty array when no suppliers found (8 ms)
  POST /api/suppliers
    âˆš should create supplier with valid data (13 ms)
    âˆš should return 400 when name is missing (12 ms)
    âˆš should return 400 when type is missing (23 ms)
    âˆš should return 400 for invalid supplier type (53 ms)
    âˆš should return 400 when code already exists (11 ms)
    âˆš should auto-generate code when not provided (28 ms)
    âˆš should increment sequence for existing prefix (13 ms)
    âˆš should default paymentModel to PREPAID (32 ms)
    âˆš should default isActive to true (13 ms)
    âˆš should trim text fields (27 ms)
    âˆš should convert creditLimit to number (12 ms)
    âˆš should return 500 on database error (23 ms)

  console.error
    Error fetching transactions: Error: Database connection failed
        at Object.<anonymous> (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\src\__tests__\api\supplier-transactions.test.ts:229:7)
        at Promise.finally.completed (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 48 |[39m     })[33m;[39m
     [90m 49 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 50 |[39m     console[33m.[39merror([32m'Error fetching transactions:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 51 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson(
     [90m 52 |[39m       { success[33m:[39m [36mfalse[39m[33m,[39m error[33m:[39m [32m'Failed to fetch transactions'[39m }[33m,[39m
     [90m 53 |[39m       { status[33m:[39m [35m500[39m }[0m

      at error (src/app/api/supplier-transactions/route.ts:50:13)
      at Object.<anonymous> (src/__tests__/api/supplier-transactions.test.ts:233:22)

  console.error
    Error creating transaction: Error: Database write failed
        at Object.<anonymous> (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\src\__tests__\api\supplier-transactions.test.ts:597:61)
        at Promise.finally.completed (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 125 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson({ success[33m:[39m [36mtrue[39m[33m,[39m data[33m:[39m transaction }[33m,[39m { status[33m:[39m [35m201[39m })[33m;[39m
     [90m 126 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 127 |[39m     console[33m.[39merror([32m'Error creating transaction:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 128 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson(
     [90m 129 |[39m       { success[33m:[39m [36mfalse[39m[33m,[39m error[33m:[39m [32m'Failed to create transaction'[39m }[33m,[39m
     [90m 130 |[39m       { status[33m:[39m [35m500[39m }[0m

      at error (src/app/api/supplier-transactions/route.ts:127:13)
      at Object.<anonymous> (src/__tests__/api/supplier-transactions.test.ts:604:22)

PASS src/__tests__/api/supplier-transactions.test.ts
  GET /api/supplier-transactions
    âˆš should return all transactions with success response (55 ms)
    âˆš should filter by supplierId (18 ms)
    âˆš should filter by transaction type (23 ms)
    âˆš should filter by date range (fromDate only) (13 ms)
    âˆš should filter by date range (toDate only) (14 ms)
    âˆš should filter by date range (both fromDate and toDate) (8 ms)
    âˆš should paginate with limit and offset (8 ms)
    âˆš should default limit to 50 (9 ms)
    âˆš should return hasMore=true when more records exist (17 ms)
    âˆš should include supplier details in response (35 ms)
    âˆš should order by transactionDate desc (22 ms)
    âˆš should return 500 on database error (335 ms)
  POST /api/supplier-transactions
    âˆš should create transaction with valid data (10 ms)
    âˆš should return 400 when supplierId is missing (14 ms)
    âˆš should return 400 when type is missing (16 ms)
    âˆš should return 400 when amount is missing (15 ms)
    âˆš should return 400 when transactionDate is missing (12 ms)
    âˆš should return 400 when amount is zero (18 ms)
    âˆš should return 400 when amount is negative (14 ms)
    âˆš should return 404 when supplier not found (11 ms)
    âˆš should convert amount to number (16 ms)
    âˆš should parse transactionDate as Date (14 ms)
    âˆš should use authenticated user ID as createdBy (15 ms)
    âˆš should ignore body createdBy and use authenticated user (9 ms)
    âˆš should include optional fields when provided (37 ms)
    âˆš should return 500 on database error (20 ms)
    transaction type validation
      âˆš should accept valid type: DEPOSIT (16 ms)
      âˆš should accept valid type: REFUND (22 ms)
      âˆš should accept valid type: ADJUSTMENT (16 ms)
      âˆš should accept valid type: FEE (24 ms)
      âˆš should return 400 for invalid type (31 ms)

PASS src/__tests__/api/operator-lock.test.ts
  GET /api/operators/lock-period
    âˆš should return tier breakdown for a month (19 ms)
    âˆš should return isFullyLocked=true when all at Final tier (7 ms)
    âˆš should return operators eligible for specific tier (7 ms)
    âˆš should return 400 for invalid month format (11 ms)
    âˆš should return 400 when month is missing (12 ms)
  POST /api/operators/lock-period
    âˆš should lock operators at KT tier (default) (13 ms)
    âˆš should lock operators at Admin tier (19 ms)
    âˆš should return count=0 when no operators to lock (12 ms)
    âˆš should return 400 for invalid month format (14 ms)
    âˆš should return 400 when month is missing (10 ms)
    âˆš should return 400 for invalid tier (15 ms)
  POST /api/operators/[id]/lock
    âˆš should lock at KT tier successfully (29 ms)
    âˆš should return 404 when operator not found (12 ms)
    âˆš should return 400 when tier already locked (17 ms)
    âˆš should return 400 when trying to skip tier progression (11 ms)
  POST /api/operators/[id]/unlock
    âˆš should unlock KT tier successfully (25 ms)
    âˆš should return 404 when operator not found (16 ms)
    âˆš should return 400 when tier not locked (16 ms)
    âˆš should return 400 when trying to unlock out of order (60 ms)
  Lock protection in existing APIs
    âˆš PUT should reject editing locked operator (12 ms)
    âˆš DELETE should reject deleting locked operator (11 ms)
    âˆš APPROVE should reject approving locked operator (12 ms)

PASS src/__tests__/lib/id-utils.test.ts
  ID Utilities
    removeDiacritics - Remove Vietnamese diacritics
      âˆš removes A diacritics (13 ms)
      âˆš removes E diacritics (2 ms)
      âˆš removes I diacritics (2 ms)
      âˆš removes O diacritics (2 ms)
      âˆš removes all U variants (1 ms)
      âˆš removes all Y variants (1 ms)
      âˆš converts D with stroke (Ä/Ä‘) (1 ms)
      âˆš preserves non-diacritic characters (2 ms)
      âˆš handles mixed strings with diacritics and plain text (12 ms)
      âˆš handles empty string (1 ms)
      âˆš handles whitespace (1 ms)
    formatTimestamp - Format as yyyyMMddHHmmssSSS
      âˆš formats date correctly (17 chars) (2 ms)
      âˆš pads single digit month correctly (1 ms)
      âˆš pads single digit date correctly (1 ms)
      âˆš pads single digit hours/minutes/seconds
      âˆš handles midnight (00:00:00)
      âˆš handles milliseconds with 3 digits padding (1 ms)
      âˆš uses current date/time when not provided (1 ms)
    formatDatePart - Format as yyyyMMdd
      âˆš formats date correctly (1 ms)
      âˆš pads single digit month (1 ms)
      âˆš pads single digit date (1 ms)
      âˆš ignores time component
      âˆš uses current date when not provided (1 ms)
    generateRequestId - Generate {SellerCode}{yyyyMMddHHmmssSSS}
      âˆš generates valid requestId format (2 ms)
      âˆš converts seller code to uppercase (1 ms)
      âˆš removes diacritics from seller code (1 ms)
      âˆš removes whitespace from seller code (1 ms)
      âˆš checks uniqueness in database (1 ms)
      âˆš retries with new timestamp on collision (3 ms)
    generateServiceId - Generate {bookingCode}-{yyyyMMddHHmmssSSS}
      âˆš generates valid serviceId format (1 ms)
      âˆš includes booking code in serviceId (1 ms)
      âˆš includes timestamp after hyphen (1 ms)
      âˆš checks uniqueness in database (1 ms)
      âˆš retries on collision (3 ms)
    generateRevenueId - Generate {bookingCode}-{yyyyMMddHHmmss}-{rowNum}
      âˆš generates valid revenueId format (2 ms)
      âˆš includes booking code (1 ms)
      âˆš formats timestamp without milliseconds (1 ms)
      âˆš increments row number for same prefix (1 ms)
      âˆš starts with row 1 for new prefix (1 ms)
      âˆš filters by prefix correctly (4 ms)
    ID generation flow
      âˆš generates unique IDs for multiple calls (1 ms)
      âˆš handles concurrent ID generation (1 ms)

PASS src/__tests__/lib/sheet-mappers.test.ts
  sheet-mappers.ts - Request Row Mapping
    mapRequestRow - Basic Structure
      âˆš should extract all required and optional fields from row (4 ms)
      âˆš should include bookingCode in output
      âˆš should handle null bookingCode when not provided (1 ms)
    mapRequestRow - Vietnamese Status Mapping to Enum Keys
      âˆš should map 'ÄÃ£ bÃ¡o giÃ¡' to DA_BAO_GIA enum key (1 ms)
      âˆš should map 'Äang xÃ¢y Tour' to DANG_XAY_TOUR enum key
      âˆš should map 'F1' to F1 enum key
      âˆš should map 'F2' to F2 enum key
      âˆš should map 'F3' to F3 enum key (1 ms)
      âˆš should map 'F4' variations to F4 enum key (1 ms)
      âˆš should map 'Booking' to BOOKING enum key (1 ms)
      âˆš should map 'KhÃ¡ch hoÃ£n' to KHACH_HOAN enum key
      âˆš should map 'Äang suy nghÄ©' to KHACH_SUY_NGHI enum key (1 ms)
      âˆš should map 'KhÃ´ng Ä‘á»§ TC' to KHONG_DU_TC enum key
      âˆš should map 'ÄÃ£ káº¿t thÃºc' to DA_KET_THUC enum key (1 ms)
      âˆš should map 'Cancel' to CANCEL enum key
      âˆš should map 'Äang LL - khÃ¡ch chÆ°a tráº£ lá»i' to DANG_LL_CHUA_TL enum key (1 ms)
      âˆš should map 'Äang LL - khÃ¡ch Ä‘Ã£ tráº£ lá»i' to DANG_LL_DA_TL enum key (1 ms)
      âˆš should default to DANG_LL_CHUA_TL for unknown status
      âˆš should default to DANG_LL_CHUA_TL for empty status
      âˆš should always return string enum key (not Vietnamese label)
    mapRequestRow - Decimal Fields
      âˆš should convert expectedRevenue to Prisma.Decimal (1 ms)
      âˆš should convert expectedCost to Prisma.Decimal (1 ms)
      âˆš should handle Vietnamese decimal format (comma as decimal separator) (1 ms)
      âˆš should handle empty Decimal fields as null (1 ms)
    mapRequestRow - Validation & Filtering
      âˆš should return null when Request ID (AR) is empty
      âˆš should return null when Seller (A) is empty (1 ms)
      âˆš should return null when customer name (B) is empty
      âˆš should return null for header rows
      âˆš should throw error when no SELLER user found (17 ms)
    mapRequestRow - Data Types & Conversions
      âˆš should convert pax string to number (1 ms)
      âˆš should default pax to 1 if empty (1 ms)
      âˆš should parse tourDays as number (1 ms)
      âˆš should handle null tourDays when empty
      âˆš should parse dates in DD/MM/YYYY format (1 ms)
      âˆš should trim whitespace from text fields (1 ms)
    mapRequestRow - Stage Mapping
      âˆš should map quote statuses to QUOTE stage
      âˆš should map F1-F4 statuses to FOLLOWUP stage (1 ms)
      âˆš should map booking/cancel statuses to OUTCOME stage
      âˆš should default to LEAD stage for unknown status (1 ms)
    mapRequestRow - Real-world Integration
      âˆš should handle complete real-world request row (1 ms)

PASS src/__tests__/lib/lock-utils.test.ts
  Lock System Utilities
    canLock - Role permissions for locking
      âˆš ACCOUNTANT can lock KT tier (1 ms)
      âˆš ADMIN can lock KT tier (1 ms)
      âˆš SELLER cannot lock KT tier
      âˆš OPERATOR cannot lock KT tier (1 ms)
      âˆš ADMIN can lock Admin tier
      âˆš ACCOUNTANT cannot lock Admin tier (1 ms)
      âˆš ADMIN can lock Final tier
    canUnlock - Role permissions for unlocking
      âˆš ACCOUNTANT can unlock KT tier (1 ms)
      âˆš ADMIN can unlock all tiers
      âˆš SELLER cannot unlock any tier
    canLockTier - Sequential lock progression
      âˆš Can lock KT when no locks exist
      âˆš Cannot lock KT when already locked (1 ms)
      âˆš Cannot lock Admin without KT lock first
      âˆš Can lock Admin when KT is locked (1 ms)
      âˆš Cannot lock Final without Admin lock first
      âˆš Can lock Final when both KT and Admin are locked (1 ms)
      âˆš Cannot lock Final when already locked
    canUnlockTier - Reverse unlock progression
      âˆš Cannot unlock any tier when none are locked (1 ms)
      âˆš Can unlock Final when Final is locked
      âˆš Cannot unlock Admin when Final is locked
      âˆš Can unlock Admin when Final is unlocked
      âˆš Cannot unlock KT when Admin is locked
      âˆš Can unlock KT when Admin is unlocked
    isEditable - Check if record is editable
      âˆš Record is editable with no locks (1 ms)
      âˆš Record is not editable with KT lock (1 ms)
      âˆš Record is not editable with Admin lock
      âˆš Record is not editable with Final lock
      âˆš Record is not editable with any combination of locks (1 ms)
    getLockFields - Generate DB update fields
      âˆš generates lock fields for KT tier (1 ms)
      âˆš generates lock fields for Admin tier (1 ms)
      âˆš generates lock fields for Final tier (1 ms)
      âˆš generates unlock fields (sets to false/null) (1 ms)
      âˆš sets correct timestamp for lock operations (1 ms)
    getCurrentLockTier - Get highest active lock tier
      âˆš returns null when no locks (1 ms)
      âˆš returns KT when only KT is locked
      âˆš returns Admin when KT and Admin are locked
      âˆš returns Final when all are locked (1 ms)
      âˆš prioritizes higher tiers (Final > Admin > KT)
    getActiveLockTiers - Get all active lock tiers
      âˆš returns empty array when no locks
      âˆš returns [KT] when only KT is locked (1 ms)
      âˆš returns [KT, Admin] when both are locked (1 ms)
      âˆš returns all tiers when all are locked (1 ms)
    hasAnyLock - Check if any lock is active
      âˆš returns false when no locks
      âˆš returns true when KT is locked
      âˆš returns true when Admin is locked (1 ms)
      âˆš returns true when Final is locked
      âˆš returns true when any combination of locks exist (1 ms)
    Lock configuration constants
      âˆš LOCK_TIERS has 3 tiers (1 ms)
      âˆš LOCK_TIER_ORDER has correct progression (1 ms)
      âˆš LOCK_PERMISSIONS configured for all tiers (1 ms)
      âˆš KT tier allows ACCOUNTANT and ADMIN to lock/unlock (1 ms)
      âˆš Admin and Final tiers allow only ADMIN (1 ms)

PASS src/app/login/__tests__/login-validation.test.ts
  Login Form Validation Schema
    Email Validation
      âˆš accepts valid email addresses (5 ms)
      âˆš rejects invalid email format (4 ms)
      âˆš rejects empty email (1 ms)
      âˆš rejects missing email field (2 ms)
    Password Validation
      âˆš accepts non-empty password (1 ms)
      âˆš rejects empty password (1 ms)
      âˆš rejects missing password field (1 ms)
    Combined Validation
      âˆš accepts valid credentials (1 ms)
      âˆš rejects both invalid email and empty password (1 ms)
      âˆš rejects extra fields in data (4 ms)
      âˆš maintains type safety of parsed data (1 ms)
    Edge Cases
      âˆš handles very long email
      âˆš handles very long password (1 ms)
      âˆš handles unicode characters in password (1 ms)
      âˆš handles whitespace in email (should fail) (1 ms)
      âˆš trims whitespace from inputs (1 ms)

PASS src/app/login/__tests__/page.test.tsx
  LoginPage
    Rendering
      âˆš renders login page without errors (41 ms)
      âˆš displays page title (7 ms)
      âˆš displays subtitle (4 ms)
      âˆš renders LoginForm component (5 ms)
      âˆš applies correct styling classes (6 ms)
      âˆš renders form container with max-width (4 ms)
    Layout Structure
      âˆš renders header section before form (4 ms)
      âˆš centers header text (3 ms)
      âˆš renders text-based UI elements in correct order (5 ms)
    Responsive Design
      âˆš applies responsive padding (4 ms)
      âˆš limits form width on larger screens (2 ms)
    Integration with LoginForm
      âˆš passes no props to LoginForm (3 ms)
      âˆš mounts LoginForm as a child component (3 ms)
    Accessibility
      âˆš maintains semantic HTML structure (3 ms)
      âˆš uses proper heading hierarchy (2 ms)

  console.error
    An update to LoginFormContent inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at Object.callback (node_modules/react-hook-form/src/useForm.ts:99:5)
      at Object.find (node_modules/react-hook-form/src/logic/shouldRenderFormState.ts:25:28)
      at Object.next (node_modules/react-hook-form/src/utils/createSubject.ts:40:5)
      at name (node_modules/react-hook-form/src/logic/createFormControl.ts:1276:20)

  console.error
    An update to LoginFormContent inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

    [0m [90m 49 |[39m
     [90m 50 |[39m   [36masync[39m [36mfunction[39m onSubmit(data[33m:[39m [33mLoginFormData[39m) {
    [31m[1m>[22m[39m[90m 51 |[39m     setIsLoading([36mtrue[39m)[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 52 |[39m
     [90m 53 |[39m     [36mtry[39m {
     [90m 54 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m signIn([32m"credentials"[39m[33m,[39m {[0m

      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setIsLoading (src/app/login/login-form.tsx:51:5)
      at errors (node_modules/react-hook-form/src/logic/createFormControl.ts:1281:24)

  console.error
    An update to LoginFormContent inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

    [0m [90m 74 |[39m       })[33m;[39m
     [90m 75 |[39m     } [36mfinally[39m {
    [31m[1m>[22m[39m[90m 76 |[39m       setIsLoading([36mfalse[39m)[33m;[39m
     [90m    |[39m       [31m[1m^[22m[39m
     [90m 77 |[39m     }
     [90m 78 |[39m   }
     [90m 79 |[39m[0m

      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setIsLoading (src/app/login/login-form.tsx:76:7)
      at unset (node_modules/react-hook-form/src/logic/createFormControl.ts:1281:7)

  console.error
    An update to LoginFormContent inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at Object.callback (node_modules/react-hook-form/src/useForm.ts:99:5)
      at Object.find (node_modules/react-hook-form/src/logic/shouldRenderFormState.ts:25:28)
      at Object.next (node_modules/react-hook-form/src/utils/createSubject.ts:40:5)
      at node_modules/react-hook-form/src/logic/createFormControl.ts:1292:7

PASS src/app/login/__tests__/login-form.test.tsx
  LoginForm Component
    Rendering
      âˆš renders login form without errors (104 ms)
      âˆš renders email and password inputs with correct attributes (8 ms)
      âˆš renders submit button in initial state (11 ms)
      âˆš renders form labels (7 ms)
    Form Validation - Email
      âˆš validates empty email field on submit (22 ms)
      âˆš allows typing invalid email format into field (7 ms)
      âˆš accepts valid email format (6 ms)
    Form Validation - Password
      âˆš validates empty password field on submit (17 ms)
      âˆš accepts non-empty password (10 ms)
    Form Structure
      âˆš renders form with proper structure (8 ms)
      âˆš groups form inputs in container divs (7 ms)
      âˆš renders input elements within form (7 ms)
    User Interaction Handling
      âˆš allows user to type in email field (6 ms)
      âˆš allows user to type in password field (6 ms)
      âˆš handles form submission event (106 ms)
    Accessibility
      âˆš associates labels with input fields (6 ms)
      âˆš submit button is accessible via keyboard (7 ms)
      âˆš uses proper ARIA attributes on inputs (4 ms)
    Error Display
      âˆš displays validation errors below fields (17 ms)
      âˆš displays errors in red text (15 ms)
    Button State Management
      âˆš button is clickable in initial state (9 ms)
      âˆš button text is Dang nhap in initial state (7 ms)

Test Suites: 1 failed, 14 passed, 15 total
Tests:       1 failed, 419 passed, 420 total
Snapshots:   0 total
Time:        8.008 s
Ran all test suites.
