
> vivatour-app@0.1.0 test
> jest

PASS src/__tests__/config/operator-config.test.ts
  SERVICE_TYPES configuration
    âˆš should have 9 service types (11 ms)
    âˆš should include all expected types (3 ms)
    âˆš should have labels and icons for all types (16 ms)
    âˆš should have correct Vietnamese labels (2 ms)
    âˆš should have valid Lucide icon names (2 ms)
  PAYMENT_STATUSES configuration
    âˆš should have 3 payment statuses (1 ms)
    âˆš should include all expected statuses (1 ms)
    âˆš should have labels and colors for all statuses (2 ms)
    âˆš should have correct Vietnamese labels (2 ms)
    âˆš should have appropriate colors (2 ms)
  HISTORY_ACTIONS configuration
    âˆš should have 6 history action types (1 ms)
    âˆš should include all expected action types (2 ms)
    âˆš should have labels and colors for all actions (3 ms)
    âˆš should have correct Vietnamese labels (2 ms)
    âˆš should have appropriate colors (2 ms)
  DEFAULT_VAT_RATE constant
    âˆš should be 10 (percent)
    âˆš should be a positive number
    âˆš should be less than 100 (reasonable VAT rate) (1 ms)
  Service types alignment with Supplier types
    âˆš should have matching service types with supplier types (2 ms)

PASS src/__tests__/config/supplier-config.test.ts
  SUPPLIER_TYPES configuration
    âˆš should have 9 supplier types (10 ms)
    âˆš should have 3-character prefixes for all types (12 ms)
    âˆš should include all expected types (3 ms)
    âˆš should have correct prefix mappings (3 ms)
  SUPPLIER_LOCATIONS configuration
    âˆš should have 18 locations (2 ms)
    âˆš should have 2-3 character prefixes for all locations (6 ms)
    âˆš should include key Vietnam locations (1 ms)
    âˆš should include international locations (1 ms)
  PAYMENT_MODELS configuration
    âˆš should have 3 payment models (1 ms)
    âˆš should include all expected models (4 ms)
    âˆš should have labels and descriptions (2 ms)
  removeDiacritics
    âˆš should remove Vietnamese diacritics from A variants (2 ms)
    âˆš should remove Vietnamese diacritics from E variants (2 ms)
    âˆš should remove Vietnamese diacritics from I variants
    âˆš should remove Vietnamese diacritics from O variants (1 ms)
    âˆš should remove Vietnamese diacritics from U variants (1 ms)
    âˆš should remove Vietnamese diacritics from Y variants
    âˆš should convert Ä to D (1 ms)
    âˆš should preserve non-diacritic characters (1 ms)
    âˆš should handle mixed strings (1 ms)
    âˆš should handle empty string (1 ms)
  getNamePrefix
    âˆš should extract first 3 characters from simple name (2 ms)
    âˆš should use first word only (1 ms)
    âˆš should handle Vietnamese names with diacritics (1 ms)
    âˆš should pad short names with X (1 ms)
    âˆš should return XXX for empty name
    âˆš should return XXX for null/undefined (1 ms)
    âˆš should trim whitespace
    âˆš should convert to uppercase (1 ms)
  generateSupplierCode
    âˆš should generate correct code format: TYPE-LOCATION-NAME-SEQUENCE (1 ms)
    âˆš should use XX for missing location
    âˆš should use XX for undefined location
    âˆš should pad sequence to 4 digits (1 ms)
    âˆš should default sequence to 1 (1 ms)
    âˆš should handle Vietnamese names correctly (1 ms)
    âˆš should handle single character name
    âˆš should handle empty name (1 ms)
    âˆš should handle name with only spaces
    âˆš should handle multi-word names (use first word only)
    for each supplier type
      âˆš should use HOT for HOTEL (1 ms)
      âˆš should use RES for RESTAURANT
      âˆš should use TRA for TRANSPORT (1 ms)
      âˆš should use GUI for GUIDE
      âˆš should use VIS for VISA
      âˆš should use VMB for VMB
      âˆš should use CRU for CRUISE (1 ms)
      âˆš should use ACT for ACTIVITY
      âˆš should use OTH for OTHER
    for each location
      âˆš should use HN for HA_NOI
      âˆš should use DN for DA_NANG
      âˆš should use HCM for HO_CHI_MINH (1 ms)
      âˆš should use HL for HA_LONG
      âˆš should use PQ for PHU_QUOC
      âˆš should use TL for THAI_LAN (1 ms)
      âˆš should use CB for CAMBODIA

PASS src/__tests__/lib/supplier-balance.test.ts
  calculateSupplierBalance
    âˆš should calculate balance correctly with all transaction types (15 ms)
    âˆš should handle zero transactions (new supplier) (20 ms)
    âˆš should handle deposits only (13 ms)
    âˆš should calculate negative balance when costs exceed deposits (9 ms)
    âˆš should handle large numeric values (11 ms)
    âˆš should call Prisma with correct supplier ID (10 ms)
  getSupplierBalanceSummary
    âˆš should return balance summary for all active suppliers (12 ms)
    âˆš should filter by supplier type when provided (17 ms)
    âˆš should return empty results for no active suppliers (13 ms)
    âˆš should count positive and negative balances correctly (9 ms)

  console.error
    Error fetching pending payments: Error: Database error
        at Object.<anonymous> (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\src\__tests__\api\operator-approvals.test.ts:179:52)
        at Promise.finally.completed (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 82 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson({ success[33m:[39m [36mtrue[39m[33m,[39m data[33m,[39m summary })[33m;[39m
     [90m 83 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 84 |[39m     console[33m.[39merror([32m'Error fetching pending payments:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 85 |[39m     [36mconst[39m message [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
     [90m 86 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson(
     [90m 87 |[39m       { success[33m:[39m [36mfalse[39m[33m,[39m error[33m:[39m [32m`Lá»—i táº£i danh sÃ¡ch: ${message}`[39m }[33m,[39m[0m

      at error (src/app/api/operators/pending-payments/route.ts:84:13)
      at Object.<anonymous> (src/__tests__/api/operator-approvals.test.ts:182:22)

  console.error
    Error fetching transactions: Error: Database connection failed
        at Object.<anonymous> (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\src\__tests__\api\supplier-transactions.test.ts:226:7)
        at Promise.finally.completed (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 47 |[39m     })[33m;[39m
     [90m 48 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 49 |[39m     console[33m.[39merror([32m'Error fetching transactions:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 50 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson(
     [90m 51 |[39m       { success[33m:[39m [36mfalse[39m[33m,[39m error[33m:[39m [32m'Failed to fetch transactions'[39m }[33m,[39m
     [90m 52 |[39m       { status[33m:[39m [35m500[39m }[0m

      at error (src/app/api/supplier-transactions/route.ts:49:13)
      at Object.<anonymous> (src/__tests__/api/supplier-transactions.test.ts:230:22)

  console.error
    Error fetching suppliers: Error: Database connection failed
        at Object.<anonymous> (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\src\__tests__\api\suppliers.test.ts:200:52)
        at Promise.finally.completed (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 55 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson({ success[33m:[39m [36mtrue[39m[33m,[39m data[33m:[39m result })[33m;[39m
     [90m 56 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 57 |[39m     console[33m.[39merror([32m'Error fetching suppliers:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 58 |[39m     [36mconst[39m message [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
     [90m 59 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson(
     [90m 60 |[39m       { success[33m:[39m [36mfalse[39m[33m,[39m error[33m:[39m [32m`Failed to fetch suppliers: ${message}`[39m }[33m,[39m[0m

      at error (src/app/api/suppliers/route.ts:57:13)
      at Object.<anonymous> (src/__tests__/api/suppliers.test.ts:203:22)

PASS src/__tests__/api/operator-approvals.test.ts
  GET /api/operators/pending-payments
    âˆš should return pending payments with success (19 ms)
    âˆš should filter by overdue (6 ms)
    âˆš should filter by today (4 ms)
    âˆš should filter by week (5 ms)
    âˆš should filter by serviceType (4 ms)
    âˆš should calculate daysOverdue correctly (3 ms)
    âˆš should return correct summary (4 ms)
    âˆš should return 500 on database error (85 ms)
  POST /api/operators/approve (batch)
    âˆš should batch approve operators successfully (12 ms)
    âˆš should return 400 when no operatorIds provided (7 ms)
    âˆš should return 400 when paymentDate is missing (6 ms)
    âˆš should return 404 when some operators not found (7 ms)
    âˆš should return 403 when trying to approve locked operators (8 ms)
  POST /api/operators/[id]/approve (single)
    âˆš should approve single operator successfully (9 ms)
    âˆš should return 404 when operator not found (61 ms)
    âˆš should return 403 when operator is locked (12 ms)
    âˆš should return 400 when already paid (13 ms)
    âˆš should use current date when paymentDate not provided (12 ms)

  console.error
    Error creating supplier: Error: Database write failed
        at Object.<anonymous> (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\src\__tests__\api\suppliers.test.ts:528:50)
        at Promise.finally.completed (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 148 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson({ success[33m:[39m [36mtrue[39m[33m,[39m data[33m:[39m supplier }[33m,[39m { status[33m:[39m [35m201[39m })[33m;[39m
     [90m 149 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 150 |[39m     console[33m.[39merror([32m'Error creating supplier:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 151 |[39m     [36mconst[39m message [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
     [90m 152 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson(
     [90m 153 |[39m       { success[33m:[39m [36mfalse[39m[33m,[39m error[33m:[39m [32m`Lá»—i táº¡o NCC: ${message}`[39m }[33m,[39m[0m

      at error (src/app/api/suppliers/route.ts:150:13)
      at Object.<anonymous> (src/__tests__/api/suppliers.test.ts:538:22)

PASS src/__tests__/api/suppliers.test.ts
  GET /api/suppliers
    âˆš should return all suppliers with success response (19 ms)
    âˆš should filter by search term (code or name) (5 ms)
    âˆš should filter by type (4 ms)
    âˆš should filter by location (3 ms)
    âˆš should filter by paymentModel (5 ms)
    âˆš should filter by isActive=true (5 ms)
    âˆš should filter by isActive=false (2 ms)
    âˆš should handle multiple filters combined (3 ms)
    âˆš should include balance when includeBalance=true (4 ms)
    âˆš should return 500 on database error (104 ms)
    âˆš should return empty array when no suppliers found (5 ms)
  POST /api/suppliers
    âˆš should create supplier with valid data (7 ms)
    âˆš should return 400 when name is missing (7 ms)
    âˆš should return 400 when type is missing (17 ms)
    âˆš should return 400 for invalid supplier type (47 ms)
    âˆš should return 400 when code already exists (9 ms)
    âˆš should auto-generate code when not provided (11 ms)
    âˆš should increment sequence for existing prefix (12 ms)
    âˆš should default paymentModel to PREPAID (12 ms)
    âˆš should default isActive to true (9 ms)
    âˆš should trim text fields (9 ms)
    âˆš should convert creditLimit to number (5 ms)
    âˆš should return 500 on database error (9 ms)

  console.error
    Error creating transaction: Error: Database write failed
        at Object.<anonymous> (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\src\__tests__\api\supplier-transactions.test.ts:592:61)
        at Promise.finally.completed (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Users\Admin\Projects\company-workflow-app\vivatour-app\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 118 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson({ success[33m:[39m [36mtrue[39m[33m,[39m data[33m:[39m transaction }[33m,[39m { status[33m:[39m [35m201[39m })[33m;[39m
     [90m 119 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 120 |[39m     console[33m.[39merror([32m'Error creating transaction:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 121 |[39m     [36mreturn[39m [33mNextResponse[39m[33m.[39mjson(
     [90m 122 |[39m       { success[33m:[39m [36mfalse[39m[33m,[39m error[33m:[39m [32m'Failed to create transaction'[39m }[33m,[39m
     [90m 123 |[39m       { status[33m:[39m [35m500[39m }[0m

      at error (src/app/api/supplier-transactions/route.ts:120:13)
      at Object.<anonymous> (src/__tests__/api/supplier-transactions.test.ts:599:22)

PASS src/__tests__/api/supplier-transactions.test.ts
  GET /api/supplier-transactions
    âˆš should return all transactions with success response (20 ms)
    âˆš should filter by supplierId (6 ms)
    âˆš should filter by transaction type (7 ms)
    âˆš should filter by date range (fromDate only) (5 ms)
    âˆš should filter by date range (toDate only) (4 ms)
    âˆš should filter by date range (both fromDate and toDate) (4 ms)
    âˆš should paginate with limit and offset (3 ms)
    âˆš should default limit to 50 (3 ms)
    âˆš should return hasMore=true when more records exist (5 ms)
    âˆš should include supplier details in response (4 ms)
    âˆš should order by transactionDate desc (4 ms)
    âˆš should return 500 on database error (100 ms)
  POST /api/supplier-transactions
    âˆš should create transaction with valid data (21 ms)
    âˆš should return 400 when supplierId is missing (12 ms)
    âˆš should return 400 when type is missing (14 ms)
    âˆš should return 400 when amount is missing (30 ms)
    âˆš should return 400 when transactionDate is missing (20 ms)
    âˆš should return 400 when amount is zero (13 ms)
    âˆš should return 400 when amount is negative (10 ms)
    âˆš should return 404 when supplier not found (16 ms)
    âˆš should convert amount to number (9 ms)
    âˆš should parse transactionDate as Date (9 ms)
    âˆš should default createdBy to system (9 ms)
    âˆš should use provided createdBy (7 ms)
    âˆš should include optional fields when provided (5 ms)
    âˆš should return 500 on database error (22 ms)
    transaction type validation
      âˆš should accept valid type: DEPOSIT (16 ms)
      âˆš should accept valid type: REFUND (14 ms)
      âˆš should accept valid type: ADJUSTMENT (9 ms)
      âˆš should accept valid type: FEE (13 ms)
      âˆš should return 400 for invalid type (7 ms)

Test Suites: 6 passed, 6 total
Tests:       156 passed, 156 total
Snapshots:   0 total
Time:        4.23 s
Ran all test suites.
